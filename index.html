<!DOCTYPE html>
<html>
<head>
  <title>GPS Tracker</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <style>
    #map { height: 100vh; }
    .info-panel {
      position: absolute; 
      top: 10px; 
      right: 10px; 
      z-index: 1000;
      background: white;
      padding: 10px;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <div class="info-panel">
    <h3>موقعیت خودرو</h3>
    <p>آخرین به‌روزرسانی: <span id="time">--:--:--</span></p>
    <p>عرض جغرافیایی: <span id="lat">---</span></p>
    <p>طول جغرافیایی: <span id="lng">---</span></p>
  </div>

  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <script>
    // تنظیمات اولیه نقشه
    const map = L.map('map').setView([35.7395, 51.2852], 15);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
    
    let marker = null;
    let lastUpdate = 0;

    // تابع به‌روزرسانی موقعیت
    function updateMap() {
      const params = new URLSearchParams(window.location.search);
      const lat = parseFloat(params.get('lat'));
      const lng = parseFloat(params.get('lng'));
      
      if (!isNaN(lat) && !isNaN(lng)) {
        const newPos = [lat, lng];
        
        if (!marker) {
          marker = L.marker(newPos).addTo(map)
            .bindPopup(`موقعیت خودرو<br>${lat.toFixed(6)}, ${lng.toFixed(6)}`);
        } else {
          marker.setLatLng(newPos);
        }
        
        map.panTo(newPos);
        document.getElementById('lat').textContent = lat.toFixed(6);
        document.getElementById('lng').textContent = lng.toFixed(6);
        document.getElementById('time').textContent = new Date().toLocaleTimeString();
      }
    }

    // به‌روزرسانی خودکار هر 5 ثانیه
    updateMap();
    setInterval(updateMap, 5000);
  </script>
</body>
</html>
