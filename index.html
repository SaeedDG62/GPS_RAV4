<!DOCTYPE html>
<html>
<head>
  <title>GPS Tracker</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <style>
    #map { 
      height: 100vh;
      width: 100%;
    }
    .info-panel {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 1000;
      background: rgba(255, 255, 255, 0.9);
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <div class="info-panel">
    <h3>Ù…ÙˆÙ‚Ø¹ÛŒØª Ø®ÙˆØ¯Ø±Ùˆ ğŸš—</h3>
    <p>Ø¢Ø®Ø±ÛŒÙ† Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: <span id="time">--:--:--</span></p>
    <p>Ø¹Ø±Ø¶ Ø¬ØºØ±Ø§ÙÛŒØ§ÛŒÛŒ: <span id="lat">---</span></p>
    <p>Ø·ÙˆÙ„ Ø¬ØºØ±Ø§ÙÛŒØ§ÛŒÛŒ: <span id="lng">---</span></p>
  </div>

  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <script>
    // ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ÙˆÙ„ÛŒÙ‡
    let map;
    let marker = null;

    // ØªØ§Ø¨Ø¹ Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
    function initMap() {
      // Ø¯Ø±ÛŒØ§ÙØª Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ÛŒ URL
      const params = new URLSearchParams(window.location.search);
      const lat = parseFloat(params.get('lat'));
      const lng = parseFloat(params.get('lng'));

      // ØªÙ†Ø¸ÛŒÙ… Ù…Ø±Ú©Ø² Ø§ÙˆÙ„ÛŒÙ‡ Ù†Ù‚Ø´Ù‡
      const defaultCenter = [35.7395, 51.2852];
      const initialZoom = 15;

      // Ø§ÛŒØ¬Ø§Ø¯ Ù†Ù‚Ø´Ù‡
      map = L.map('map').setView(
        (lat && lng) ? [lat, lng] : defaultCenter,
        initialZoom
      );

      // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù„Ø§ÛŒÙ‡ Ù†Ù‚Ø´Ù‡
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
      }).addTo(map);

      // Ø§ÛŒØ¬Ø§Ø¯ Ù†Ø´Ø§Ù†Ú¯Ø± Ø¯Ø± ØµÙˆØ±Øª ÙˆØ¬ÙˆØ¯ Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§
      if (lat && lng) {
        createMarker(lat, lng);
      }
    }

    // ØªØ§Ø¨Ø¹ Ø§ÛŒØ¬Ø§Ø¯ Ù†Ø´Ø§Ù†Ú¯Ø±
    function createMarker(lat, lng) {
      if (marker) {
        marker.remove();
      }
      
      marker = L.marker([lat, lng])
        .addTo(map)
        .bindPopup(`
          <b>Ù…ÙˆÙ‚Ø¹ÛŒØª Ø®ÙˆØ¯Ø±Ùˆ</b><br>
          Ø¹Ø±Ø¶: ${lat.toFixed(6)}<br>
          Ø·ÙˆÙ„: ${lng.toFixed(6)}
        `)
        .openPopup();

      // ØªÙ†Ø¸ÛŒÙ… Ø¯ÛŒØ¯ Ù†Ù‚Ø´Ù‡
      map.setView([lat, lng], 15);
      
      // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª
      document.getElementById('lat').textContent = lat.toFixed(6);
      document.getElementById('lng').textContent = lng.toFixed(6);
      document.getElementById('time').textContent = new Date().toLocaleTimeString();
    }

    // ØªØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ
   function updateMap() {
    const startTime = performance.now(); // Ø²Ù…Ø§Ù† Ø´Ø±ÙˆØ¹
    
    const params = new URLSearchParams(window.location.search);
    const lat = parseFloat(params.get('lat'));
    const lng = parseFloat(params.get('lng'));
    
    // Ø§Ú¯Ø± Ù…Ø®ØªØµØ§Øª Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³ØªØŒ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø±Ø§ Ù…ØªÙˆÙ‚Ù Ú©Ù†
    if (isNaN(lat) || isNaN(lng)) {
        console.warn("Ù…Ø®ØªØµØ§Øª Ù†Ø§Ù…Ø¹ØªØ¨Ø±!");
        return;
    }

    // Ø­Ø±Ú©Øª Ù†Ø±Ù… Ù†Ø´Ø§Ù†Ú¯Ø± Ø¨Ø§ Ø§Ù†ÛŒÙ…ÛŒØ´Ù†
    if (marker) {
        marker.setLatLng([lat, lng], {animate: true, duration: 500});
    } else {
        marker = L.marker([lat, lng]).addTo(map);
    }

    // Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ØªÙ†
    requestAnimationFrame(() => {
        document.getElementById('lat').textContent = lat.toFixed(6);
        document.getElementById('lng').textContent = lng.toFixed(6);
        document.getElementById('time').textContent = new Date().toLocaleTimeString();
    });

    console.log(`Ø²Ù…Ø§Ù† Ø§Ø¬Ø±Ø§: ${performance.now() - startTime}ms`);
}

    // Ø´Ø±ÙˆØ¹ Ø¨Ø±Ù†Ø§Ù…Ù‡
    initMap();
    
    // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ù‡Ø± 3 Ø«Ø§Ù†ÛŒÙ‡
    setInterval(updateMap, 3000);
  </script>
</body>
</html>
